{"version":3,"file":"5-CiXxRoLD.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(admin)/users/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/5.js"],"sourcesContent":["import { fail, redirect } from \"@sveltejs/kit\";\nimport { r as requireAdmin } from \"../../../../chunks/guards.js\";\nimport { S as ServiceFactory } from \"../../../../chunks/serviceFactory.js\";\nconst PAGE_SIZE = 10;\nconst load = async (event) => {\n  const admin = requireAdmin(event);\n  const url = event.url;\n  const page = Math.max(1, Number(url.searchParams.get(\"page\") ?? 1));\n  const role = url.searchParams.get(\"role\") ?? \"all\";\n  const status = url.searchParams.get(\"status\") ?? \"all\";\n  const userService = ServiceFactory.create(\"user\");\n  const items = await userService.listUsers(\n    { page, pageSize: PAGE_SIZE, role, status },\n    { id: admin.id, role: admin.role }\n  );\n  return { user: admin, items, page, role, status };\n};\nconst actions = {\n  createUser: async (event) => {\n    const admin = requireAdmin(event);\n    const data = await event.request.formData();\n    const email = String(data.get(\"email\") ?? \"\").toLowerCase().trim();\n    const password = String(data.get(\"password\") ?? \"\");\n    const username = String(data.get(\"username\") ?? \"\").trim();\n    const age = String(data.get(\"age\") ?? \"\").trim();\n    const role = String(data.get(\"role\") ?? \"user\").toLowerCase();\n    try {\n      const userService = ServiceFactory.create(\"user\");\n      await userService.createUser(\n        { email, password, username, age, role },\n        { id: admin.id, role: admin.role }\n      );\n      return { success: true, message: `Usuario ${email} creado correctamente como ${role}` };\n    } catch (e) {\n      const message = e instanceof Error ? e.message : \"Error creando usuario\";\n      return fail(400, { message });\n    }\n  },\n  setRole: async (event) => {\n    const admin = requireAdmin(event);\n    const data = await event.request.formData();\n    const id = String(data.get(\"id\") ?? \"\");\n    const newRole = String(data.get(\"role\") ?? \"\");\n    if (!id) return fail(400, { message: \"Datos invÃ¡lidos\" });\n    const userService = ServiceFactory.create(\"user\");\n    await userService.setRole(id, newRole, { id: admin.id, role: admin.role });\n    throw redirect(303, \"/users\");\n  },\n  suspend: async (event) => {\n    const admin = requireAdmin(event);\n    const data = await event.request.formData();\n    const id = String(data.get(\"id\") ?? \"\");\n    if (!id) return fail(400, { message: \"Sin id\" });\n    const userService = ServiceFactory.create(\"user\");\n    await userService.suspend(id, { id: admin.id, role: admin.role });\n    throw redirect(303, \"/users\");\n  },\n  resume: async (event) => {\n    const admin = requireAdmin(event);\n    const data = await event.request.formData();\n    const id = String(data.get(\"id\") ?? \"\");\n    if (!id) return fail(400, { message: \"Sin id\" });\n    const userService = ServiceFactory.create(\"user\");\n    await userService.resume(id, { id: admin.id, role: admin.role });\n    throw redirect(303, \"/users\");\n  },\n  softDelete: async (event) => {\n    const admin = requireAdmin(event);\n    const data = await event.request.formData();\n    const id = String(data.get(\"id\") ?? \"\");\n    if (!id) return fail(400, { message: \"Sin id\" });\n    const userService = ServiceFactory.create(\"user\");\n    await userService.softDelete(id, { id: admin.id, role: admin.role });\n    throw redirect(303, \"/users?status=deleted\");\n  }\n};\nexport {\n  actions,\n  load\n};\n","import * as server from '../entries/pages/(admin)/users/_page.server.ts.js';\n\nexport const index = 5;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/(admin)/users/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/(admin)/users/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/5.DD354QqY.js\",\"_app/immutable/chunks/CLFBao1S.js\",\"_app/immutable/chunks/D-rjrqWF.js\",\"_app/immutable/chunks/R2lLDMU1.js\",\"_app/immutable/chunks/1ipHKKXI.js\",\"_app/immutable/chunks/DcMo3cCv.js\",\"_app/immutable/chunks/DYby9N2k.js\",\"_app/immutable/chunks/BWJMsvq9.js\",\"_app/immutable/chunks/BMTFBQAs.js\",\"_app/immutable/chunks/SsGePZVV.js\",\"_app/immutable/chunks/CDGVdonO.js\",\"_app/immutable/chunks/DR-j32Px.js\"];\nexport const stylesheets = [\"_app/immutable/assets/5.B-lVpkDm.css\"];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}