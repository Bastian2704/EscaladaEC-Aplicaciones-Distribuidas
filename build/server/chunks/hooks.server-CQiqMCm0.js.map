{"version":3,"file":"hooks.server-CQiqMCm0.js","sources":["../../../.svelte-kit/adapter-node/chunks/hooks.server.js"],"sourcesContent":["import { l as lucia } from \"./lucia.js\";\nconst handle = async ({ event, resolve }) => {\n  const sessionId = event.cookies.get(\"session\") ?? null;\n  if (!sessionId) {\n    event.locals.user = null;\n    event.locals.session = null;\n    const blank = lucia.createBlankSessionCookie();\n    event.cookies.set(blank.name, blank.value, { ...blank.attributes, path: \"/\" });\n    return resolve(event);\n  }\n  const { session, user } = await lucia.validateSession(sessionId).catch(() => ({ session: null, user: null }));\n  const s = session;\n  if (s?.fresh) {\n    const cookie = lucia.createSessionCookie(s.id);\n    event.cookies.set(cookie.name, cookie.value, { ...cookie.attributes, path: \"/\" });\n  } else if (!session) {\n    const blank = lucia.createBlankSessionCookie();\n    event.cookies.set(blank.name, blank.value, { ...blank.attributes, path: \"/\" });\n  }\n  event.locals.user = user ? {\n    id: user.id,\n    email: user.email,\n    role: user.role\n  } : null;\n  event.locals.session = session ? { id: session.id } : null;\n  return resolve(event);\n};\nexport {\n  handle\n};\n"],"names":[],"mappings":";;;;;;AACK,MAAC,MAAM,GAAG,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK;AAC7C,EAAE,MAAM,SAAS,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,IAAI,IAAI;AACxD,EAAE,IAAI,CAAC,SAAS,EAAE;AAClB,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,GAAG,IAAI;AAC5B,IAAI,KAAK,CAAC,MAAM,CAAC,OAAO,GAAG,IAAI;AAC/B,IAAI,MAAM,KAAK,GAAG,KAAK,CAAC,wBAAwB,EAAE;AAClD,IAAI,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,KAAK,EAAE,EAAE,GAAG,KAAK,CAAC,UAAU,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC;AAClF,IAAI,OAAO,OAAO,CAAC,KAAK,CAAC;AACzB,EAAE;AACF,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,MAAM,KAAK,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC,KAAK,CAAC,OAAO,EAAE,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;AAC/G,EAAE,MAAM,CAAC,GAAG,OAAO;AACnB,EAAE,IAAI,CAAC,EAAE,KAAK,EAAE;AAChB,IAAI,MAAM,MAAM,GAAG,KAAK,CAAC,mBAAmB,CAAC,CAAC,CAAC,EAAE,CAAC;AAClD,IAAI,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,KAAK,EAAE,EAAE,GAAG,MAAM,CAAC,UAAU,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC;AACrF,EAAE,CAAC,MAAM,IAAI,CAAC,OAAO,EAAE;AACvB,IAAI,MAAM,KAAK,GAAG,KAAK,CAAC,wBAAwB,EAAE;AAClD,IAAI,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,KAAK,EAAE,EAAE,GAAG,KAAK,CAAC,UAAU,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC;AAClF,EAAE;AACF,EAAE,KAAK,CAAC,MAAM,CAAC,IAAI,GAAG,IAAI,GAAG;AAC7B,IAAI,EAAE,EAAE,IAAI,CAAC,EAAE;AACf,IAAI,KAAK,EAAE,IAAI,CAAC,KAAK;AACrB,IAAI,IAAI,EAAE,IAAI,CAAC;AACf,GAAG,GAAG,IAAI;AACV,EAAE,KAAK,CAAC,MAAM,CAAC,OAAO,GAAG,OAAO,GAAG,EAAE,EAAE,EAAE,OAAO,CAAC,EAAE,EAAE,GAAG,IAAI;AAC5D,EAAE,OAAO,OAAO,CAAC,KAAK,CAAC;AACvB;;;;"}